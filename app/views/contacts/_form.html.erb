<%= form_with model: @contact, html: { class: 'card p-3' } do |f| %>
  <!-- Action Dropdown - Top Right -->
  <div class="d-flex justify-content-end mb-3">
    <div class="dropdown">
      <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-ellipsis-v"></i>
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        <li>
          <button type="button" class="dropdown-item" onclick="document.getElementById('submit-btn').click();" style="border: none; background: none; width: 100%; text-align: left;">
            <i class="fas fa-save me-2"></i>Save Contact
          </button>
        </li>
        <li><hr class="dropdown-divider"></li>
        <li>
          <% if @company.present? %>
            <%= link_to 'Cancel', company_path(@company), class: 'dropdown-item' %>
          <% else %>
            <%= link_to 'Cancel', contacts_path, class: 'dropdown-item' %>
          <% end %>
        </li>
      </ul>
    </div>
  </div>

  <div class="row g-3">
    <!-- Hidden company_id field -->
    <%= f.hidden_field :company_id %>
    <!-- Hidden company_id for redirect logic -->
    <% if params[:company_id].present? %>
      <%= hidden_field_tag :company_id, params[:company_id] %>
    <% end %>

    <!-- Show company name if coming from company context -->
    <% if @company.present? %>
      <div class="col-12">
        <div class="alert alert-info">
          <strong>Creating contact for:</strong> <%= @company.name %>
        </div>
      </div>
      <div class="col-12">
        <label class="form-label">Company</label>
        <input type="text" class="form-control" value="<%= @company.name %>" readonly>
      </div>
    <% end %>

    <div class="col-md-6">
      <%= f.label :customer_name, class: 'form-label' %>
      <%= f.text_field :customer_name, class: 'form-control', required: true %>
    </div>
    <div class="col-md-6">
      <%= f.label :email, class: 'form-label' %>
      <%= f.email_field :email, class: 'form-control', required: true %>
    </div>
    <div class="col-md-6">
      <%= f.label :phone, class: 'form-label' %>
      <%= f.text_field :phone, class: 'form-control' %>
    </div>

    <!-- Only show user_id field if not coming from company context -->
    <% unless @company.present? %>
      <div class="col-md-6">
        <%= f.label :user_id, class: 'form-label' %>
        <%= f.hidden_field :user_id %>
        <input type="text" class="form-control" value="<%= @contact.user&.name || current_user&.name || 'Unknown' %>" readonly>
      </div>
    <% end %>
  </div>

  <!-- Hidden submit button for dropdown action -->
  <%= f.submit 'Save Contact', id: 'submit-btn', style: 'display: none;' %>

<% end %>
